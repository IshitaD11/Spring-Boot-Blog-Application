FROM maven:3.9.4-eclipse-temurin-21 AS build
COPY . .
RUN mvn clean package -DskipTests

FROM openjdk:21-slim
ARG AWS_ACCESS_KEY_ID
ARG AWS_BUCKET_NAME
ARG AWS_REGION
ARG AWS_SECRET_ACCESS_KEY
ARG DB_URL
ARG DB_USERNAME
ARG DB_PASSWORD
ARG EMAIL_ID
ARG EMAIL_PW

ENV AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
ENV AWS_BUCKET_NAME=$AWS_BUCKET_NAME
ENV AWS_REGION=$AWS_REGION
ENV AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
ENV DB_URL=$DB_URL
ENV DB_USERNAME=$DB_USERNAME
ENV DB_PASSWORD=$DB_PASSWORD
ENV EMAIL_ID=$EMAIL_ID
ENV EMAIL_PW=$EMAIL_PW
COPY --from=build /target/spring-boot-blog-application-0.0.1-SNAPSHOT.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java","-jar","app.jar"]
